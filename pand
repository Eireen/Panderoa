#!/bin/bash

. ./conf.sh

. ./lib.sh

if [ `id -u` -ne 0 ]; then
    echo "Error: You must be root to run this script!"
    exit 1
fi

# Проверка наличия основных рабочих каталогов
PAND_FOLDER=`pwd`
ADMIN_FOLDER="$PAND_FOLDER/admin"
MODULES_FOLDER="$PAND_FOLDER/modules"

checkDir "$ADMIN_FOLDER"
checkDir "$MODULES_FOLDER"

# Подключение главного файла конфигурации
MAIN_CONFIG="$PAND_FOLDER/conf.sh"

checkFile "$MAIN_CONFIG"

. "$MAIN_CONFIG"

INIT="$ADMIN_FOLDER/init.sh"
ADMIN="$ADMIN_FOLDER/admin.sh"

if [ $# -eq 0 ] ; then
    # Первоначальная настройка сервера
    checkFile "$INIT"
    . "$INIT"
else
    # Администрирование
    checkFile "$ADMIN"
    . "$ADMIN" $*
fi